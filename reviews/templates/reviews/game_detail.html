{% load static %}
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>{{ game.title }}</title>
  <style>
    html, body { height: 100%; margin: 0; }
    body {
      background:
        {% if game.image %} url("{{ game.image.url }}")
        {% elif game.image_url %} url("{{ game.image_url }}")
        {% elif game.image_filename %} url("{% static 'games/' %}{{ game.image_filename }}")
        {% else %} url("{% static 'reviews/placeholder.jpg' %}")
        {% endif %}
        no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      font-family: Arial, sans-serif;
    }
    .content {
      max-width: 900px;
      margin: 24px auto;
      padding: 24px;
      background: rgba(0,0,0,.55);
      border-radius: 10px;
    }
    .cover { display:block; max-width:100%; height:auto; border-radius:8px; margin:0 0 16px 0; }
    a, a:visited { color:#fff; }
  </style>
</head>
<body>
  <div class="content">
    <p><a href="{% url 'game_list' %}">← Zpět na hry</a></p>

    <h1>{{ game.title }}</h1>

    {% if game.image %}
      <img class="cover" src="{{ game.image.url }}" alt="{{ game.title }}">
    {% elif game.image_url %}
      <img class="cover" src="{{ game.image_url }}" alt="{{ game.title }}">
    {% elif game.image_filename %}
      <img class="cover" src="{% static 'games/' %}{{ game.image_filename }}" alt="{{ game.title }}">
    {% else %}
      <img class="cover" src="{% static 'reviews/placeholder.jpg' %}" alt="{{ game.title }}">
    {% endif %}

    <p><strong>Cena:</strong> {{ game.price }} Kč</p>
    {% if game.description %}<p>{{ game.description }}</p>{% endif %}
    <h3>Průměrné hodnocení: {{ game.average_rating|floatformat:1 }}/10</h3>

    <hr>
    <h2>Hodnocení uživatelů</h2>
    {% if reviews %}
      <ul>
        {% for r in reviews %}
          <li style="margin-bottom:10px;">
            <strong>{{ r.user }}</strong> — {{ r.rating }}/10<br>
            {% if r.text %}{{ r.text }}{% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p><em>Zatím žádné hodnocení.</em></p>
    {% endif %}

    {% if form %}
      <hr>
      <h3>Přidat / upravit své hodnocení</h3>
      <form method="post">{% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Uložit</button>
      </form>
    {% else %}
      <p><em>Pro přidání hodnocení se <a href="{% url 'login' %}?next={{ request.path }}">přihlas</a>.</em></p>
    {% endif %}
    <div class="mt-4">
    <a href="/api/wikis/" class="btn btn outline-info" target="_blank">
    
    	Zobrazit Wiki (api)
    </a>
    </div>
  </div>

  <div id="loader" style="
    display:none;
    position:fixed;
    top:0;left:0;width:100%;height:100%;
    background:rgba(255,255,255,0.8);
    z-index:9999;
    color:black;
    font-size:48px;
    font-weight:bold;
    text-align:center;
    padding-top:20%;
  ">
    Načítám...
      </div>

  <script>
  document.addEventListener("DOMContentLoaded", function() {
    const loader = document.getElementById("loader");

    document.querySelectorAll("a").forEach(link => {
      link.addEventListener("click", function() {
        loader.style.display = "block";
      });
    });

    document.querySelectorAll("form").forEach(form => {
      form.addEventListener("submit", function() {
        loader.style.display = "block";
      });
    });
  });
  </script>
</body>
</html>
